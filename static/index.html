<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SharePoint Q&A Agent</title>
  <link rel="stylesheet" href="/static/css/styles.css" />
  <!-- MSAL.js 2.x for Entra ID authentication -->
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
  <!-- marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
</head>
<body>
  <!-- ── Login screen ────────────────────────────────────────────── -->
  <div id="login-screen" class="login-screen">
    <div class="login-card">
      <div class="login-logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <h1>SharePoint Q&A Agent</h1>
      <p>Ask questions about your SharePoint documents</p>
      <button id="login-btn" class="btn btn-primary">Sign in with Microsoft</button>
    </div>
  </div>

  <!-- ── Main app (hidden until authenticated) ───────────────────── -->
  <div id="app" class="app hidden">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h2>Conversations</h2>
        <button id="new-chat-btn" class="btn btn-icon" title="New Chat">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </button>
      </div>
      <div id="conversation-list" class="conversation-list">
        <!-- Populated by conversations.js -->
      </div>
    </aside>

    <!-- Main chat area -->
    <main class="main-content">
      <!-- Top bar -->
      <header class="top-bar">
        <button id="sidebar-toggle" class="btn btn-icon sidebar-toggle" title="Toggle sidebar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <div class="approach-selector">
          <label for="approach-select">Approach:</label>
          <select id="approach-select">
            <!-- Populated by app.js from /approaches -->
          </select>
        </div>
        <div class="user-info">
          <span id="user-name"></span>
          <button id="theme-toggle" class="btn btn-icon" title="Toggle theme">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
          <button id="logout-btn" class="btn btn-sm">Sign out</button>
        </div>
      </header>

      <!-- Messages area -->
      <div id="messages" class="messages">
        <div class="welcome-message">
          <h2>Welcome to SharePoint Q&A</h2>
          <p>Ask questions about your SharePoint documents. I'll find relevant information and provide grounded answers with source citations.</p>
        </div>
      </div>

      <!-- Typing indicator -->
      <div id="typing-indicator" class="typing-indicator hidden">
        <div class="typing-dots">
          <span></span><span></span><span></span>
        </div>
        <span class="typing-text">Searching documents and generating answer...</span>
      </div>

      <!-- Input area -->
      <div class="input-area">
        <div class="input-wrapper">
          <textarea id="message-input" placeholder="Ask a question about your SharePoint documents..." rows="1"></textarea>
          <button id="send-btn" class="btn btn-primary btn-send" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="/static/js/auth.js"></script>
  <script src="/static/js/chat.js"></script>
  <script src="/static/js/conversations.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
